`product:race` ~ "Product type $\\times$ Race"
)
)
model.Adhere.product.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
)
adhere.demo.tab.product <-
model.Adhere.product.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
adhere.demo.tab.product <-
model.Adhere.product.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
adhere.demo.tab.freq <-
model.Adhere.freq.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
adhere.demo.tab.product <-
model.Adhere.product.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
adhere.demo.tab.freq <-
model.Adhere.freq.1 %>%
tbl_regression(
exponentiate = T,
label = list(
freq ~ "Regimen",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:freq` ~ "Age $\\times$ Regimen",
`freq:gender` ~ "Regimen $\\times$ Gender",
`freq:race` ~ "Regimen $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
tbl_merge(adhere.demo.tab.product, adhere.demo.tab.freq)
tbl_merge(list(adhere.demo.tab.product, adhere.demo.tab.freq))
adhere.demo.tab.product <-
model.Adhere.product.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
adhere.demo.tab.freq <-
model.Adhere.freq.1 %>%
tbl_regression(
exponentiate = T,
label = list(
freq ~ "Regimen",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:freq` ~ "Age $\\times$ Regimen",
`freq:gender` ~ "Regimen $\\times$ Gender",
`freq:race` ~ "Regimen $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
tbl_merge(list(adhere.demo.tab.product, adhere.demo.tab.freq)) %>%
as_kable(booktabs = T, caption = "Coefficent estimates of the effects of demographic factors and product used on the adherence.") %>%  kable_styling(latex_options = c("hold_position")) %>%
add_header_above(c("", "Model for product type" = 3, "Model for regimen" = 3))
adhere.demo.tab.product <-
model.Adhere.product.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "OR")
)
adhere.demo.tab.freq <-
model.Adhere.freq.1 %>%
tbl_regression(
exponentiate = T,
label = list(
freq ~ "Regimen",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:freq` ~ "Age $\\times$ Regimen",
`freq:gender` ~ "Regimen $\\times$ Gender",
`freq:race` ~ "Regimen $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "OR")
)
tbl_merge(list(adhere.demo.tab.product, adhere.demo.tab.freq)) %>%
as_kable(booktabs = T, caption = "Coefficent estimates of the effects of demographic factors and product used on the adherence.", escape = F) %>%  kable_styling(latex_options = c("hold_position")) %>%
add_header_above(c("", "Model for product type" = 3, "Model for regimen" = 3))
View(endpoints.PK)
source(knitr::purl("P9185_project1.Rmd", quiet=TRUE))
source(knitr::purl("P9185_project1.Rmd", quiet=TRUE))
# Create a data frame with the table information
table_trt <- data.frame(
Treatment = c("Pill A", "Gel B", "Gel C"),
Description = c("200 mg, once a day for 4 weeks",
"1% gel concentration; three times a day on affected areas, daily use for 4 weeks",
"2% gel concentration; once a day on affected areas, daily use for 4 weeks")
)
# Generate the table with kable and style it with kableExtra
kable(table_trt, "latex", booktabs = TRUE, caption = "Recommended doses/administration schedule") %>%
kable_styling(position = "center", latex_options = "hold_position") %>%
column_spec(1, bold = TRUE)
study_regimen <- data.frame(
Sequence = 1:6,
`Period 1` = c("Pill A", "Gel C", "Gel B", "Gel B", "Pill A", "Gel C"),
`Period 2` = c("Gel B", "Pill A", "Gel C", "Pill A", "Gel C", "Gel B"),
`Period 3` = c("Gel C", "Gel B", "Pill A", "Gel C", "Gel B", "Pill A")
)
# Generate the table with kable and kableExtra
kable(study_regimen, "latex", booktabs = TRUE, col.names = c("Sequence", "Period 1", "period 2", "Period 3"), caption = "Study Regimen") %>%
kable_styling(latex_options = c("hold_position"), full_width = FALSE, position = "center")
baseline.demo <-
left_join(Adhere.demo, baseline.dat %>% select(ptid, bviral0, sviral0)) %>%
left_join(
.,
endpoints.period %>% select(ptid, sequence) %>% distinct()
)
library(table1)
baseline.demo$gender <- factor(baseline.demo$gender, levels = c("male", "female"), labels = c("Male", "Female"))
baseline.demo$race <- factor(baseline.demo$race, levels = c("white", "black", "others"), labels = c("White", "Black", "Others"))
label(baseline.demo$gender) = "Gender"
label(baseline.demo$race) = "Race"
label(baseline.demo$age) = "Age"
label(baseline.demo$bviral0) = "Baseline blood viral load"
label(baseline.demo$sviral0) = "Baseline skin viral load"
label(baseline.demo$sequence) = "Treatment sequence"
library(gt)
demo.tab <-
table1(~ age + gender + race + bviral0 + sviral0 | sequence,
data=baseline.demo, caption="Descriptive statistics of baseline characteristics of the 180 subjects by treatment sequences.") %>% t1kable(booktabs = TRUE) %>%  kable_styling(latex_options = c("hold_position", "scale_down"))
demo.tab
library(latex2exp)
library(ggpubr)
plot.ae <-
endpoints.AE %>%
filter(AE ==1) %>%
group_by(drug, week) %>%
ggplot(aes(x=week))+
geom_bar()+
facet_grid(.~factor(drug, levels=c('Pill A','Gel B','Gel C')))+
theme_bw()+
ylab("Number of Subjects")+
xlab("Week Number in a Treatment Period")
#plot.ae
plot.adhere <-
endpoints.Adhere %>%
# each line is adherence of a drug taken by a subject
ggplot(aes(x = week, y = log(Adhere/7/ (1-Adhere/7)))) +
geom_line(alpha = 0.2,aes(x = week, y = log(Adhere/7/ (1-Adhere/7)),group = interaction(ptid, drug))) +
geom_point(alpha = 0.1, size = 0.8,aes(x = week, y = log(Adhere/7/ (1-Adhere/7)),group = interaction(ptid, drug)))+
geom_smooth(method = "lm")+
facet_grid(.~drug)+
theme_bw() +
ylab(TeX("$\\log\\left(\\frac{p_{ijk}}{1-p_{ijk}}\\right)$"))
#plot.adhere
plot.PK <-
endpoints.PK %>%
ggplot(aes(y=dvalue, x=period))+
geom_smooth(method = "lm", se = FALSE, show.legend = FALSE) +
geom_line(alpha = 0.2, aes(group = ptid)) +
geom_point(alpha = 0.1, size = 0.8) +
facet_grid(.~measure)+
xlab("Period")+
ylab("Viral Load Difference")+
theme_bw()
#plot.PK
ggarrange(plot.ae, plot.adhere,
#labels = c("(a)", "(b)"),
ncol = 1, nrow = 2)
plot.adhere.demo <-
endpoints.PK %>%
mutate(product_type = if_else(drug=="Pill A", "Drug", "Gel"),
regimen = if_else(drug== "Gel B", "3 times/day", "1 time/day"),
product_dosage = case_when(
drug == "Pill A" ~ "Drug, 1 time/day",
drug == "Gel B" ~ "Gel, 3 times/day",
drug == "Gel C" ~"Gel, 1 time/day"
)) %>%
ggplot(aes(y = Adhere_rate, x = age))+
#geom_boxplot()+
geom_point()+
geom_hline(yintercept = 1, linetype = 2, color = "grey")+
geom_smooth(color="blue", method="loess")+
facet_grid(gender + race~regimen + product_type)+
theme_bw()+
ylab("Adherence Rate of a Treatment Period")+
xlab("Age") +
labs(caption = "(Age is centered)")
library(patchwork)
plot.adhere.demo
plot.pk.ae <-
endpoints.PK %>%
ggplot(aes(y=dvalue, x=drug))+
geom_boxplot()+
facet_grid(AE_ind ~measure)+
theme_bw()+
ylab("Viral Load Difference")+
xlab("Treatments")
plot.pk.adhere <-
endpoints.PK %>%
ggplot(aes(y=dvalue, x=Adhere_sum))+
#geom_boxplot(aes(group = Adhere_sum))+
geom_point(size=0.8)+
geom_smooth(method = "lm", se = FALSE, show.legend = FALSE) +
facet_grid(drug~measure)+
xlab("Number of Adherence Days in a Treatment Period")+
ylab("Viral Load Difference")+
theme_bw()
ggarrange(plot.pk.ae, plot.pk.adhere,
ncol = 1, nrow =2)
tbl.ae.co.model <-
AE.crossover.model %>%
tbl_regression(
exponentiate = T,
label = list(
period ~ "Period",
seq2 ~ "Sequence"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
tbl.ae.co.model %>% as_kable(booktabs = T, caption = "Coefficent estimates of the carry-over effect model of adverse events.") %>%  kable_styling(latex_options = c("hold_position"))
tbl.adhere.co.model <-
Adhere.crossover.model %>%
tbl_regression(
exponentiate = T,
label = list(
period ~ "Period",
seq2 ~ "Sequence"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
)
tbl.adhere.co.model %>%   as_kable(booktabs = T, caption = "Coefficent estimates of the carry-over effect model of adherence.") %>%  kable_styling(latex_options = c("hold_position"))
tbl.pk.co.model.b <-
PK.crossover.model.bviral %>%
tbl_regression(
exponentiate = F,
label = list(
period ~ "Period",
seq2 ~ "Sequence"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "$\\hat\\beta$")
)
tbl.pk.co.model.b %>%   as_kable(booktabs = T, caption = "Coefficent estimates of the carry-over effect model of blood viral loads.") %>%  kable_styling(latex_options = c("hold_position"))
tbl.pk.co.model.s <-
PK.crossover.model.sviral %>%
tbl_regression(
exponentiate = F,
label = list(
period ~ "Period",
seq2 ~ "Sequence"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "$\\hat\\beta$")
)
tbl.pk.co.model.s %>%   as_kable(booktabs = T, caption = "Coefficent estimates of the carry-over effect model of skin viral loads.") %>%  kable_styling(latex_options = c("hold_position"))
model.AE %>%
tbl_regression(
exponentiate = T,
label = list(
drug ~ "Treatment",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race"
),
include = everything()) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
) %>%
as_kable(booktabs = T, caption = "Coefficent estimates of the treatment effects on the safety outcome.") %>%
kable_styling(latex_options = c("hold_position"))
model.Adhere %>%
tbl_regression(
exponentiate = T,
label = list(
week ~ "Week",
drug ~ "Treatment",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race"
)) %>%
modify_header(
update = list(p.value = "p-value", ci = "95% CI", label = "Characteristics", estimate = "OR")
) %>%
as_kable(booktabs = T, caption = "Coefficent estimates of the treatment effects on the adherence.") %>%
kable_styling(latex_options = c("hold_position"))
tab.bviral <-
model.PK.bviral %>%
tbl_regression(
exponentiate = F,
label = list(
Adhere_sum_centered ~ "Days of adherece (within a period, centered)",
drug ~ "Treatment",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
AE_ind ~ "Occurence of adverse effects"
)) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "$\\hat\\beta$")
)
#tab.bviral
tab.sviral <-
model.PK.sviral %>%
tbl_regression(
exponentiate = F,
label = list(
Adhere_sum_centered ~ "Days of adherece (within a period, centered)",
drug ~ "Treatment",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
AE_ind ~ "Occurence of adverse effects"
)) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "$\\hat\\gamma$")
)
#tab.sviral
tbl_merge(
list(tab.bviral, tab.sviral),
) %>%
as_kable(booktabs = T, caption = "Coefficent estimates of the treatment effects on the pharmacokenitics.", escape = F) %>%  kable_styling(latex_options = c("hold_position", "scale_down")) %>%
add_header_above(c("", "Blood viral loads model" = 2, "Skin viral loads model" = 2))
adhere.demo.tab.product <-
model.Adhere.product.1 %>%
tbl_regression(
exponentiate = T,
label = list(
product ~ "Product type",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:product` ~ "Age $\\times$ Product type",
`product:gender` ~ "Product type $\\times$ Gender",
`product:race` ~ "Product type $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "OR")
)
adhere.demo.tab.freq <-
model.Adhere.freq.1 %>%
tbl_regression(
exponentiate = T,
label = list(
freq ~ "Regimen",
period ~ "Period",
age ~ "Age",
gender ~ "Gender",
race ~ "Race",
week~ "Week",
`age:freq` ~ "Age $\\times$ Regimen",
`freq:gender` ~ "Regimen $\\times$ Gender",
`freq:race` ~ "Regimen $\\times$ Race"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "OR")
)
tbl_merge(list(adhere.demo.tab.product, adhere.demo.tab.freq)) %>%
as_kable(booktabs = T, caption = "Coefficent estimates of the effects of demographic factors and product used on the adherence.", escape = F) %>%  kable_styling(latex_options = c("hold_position", "scale_down")) %>%
add_header_above(c("", "Model for product type" = 3, "Model for regimen" = 3))
View(endpoints.PK)
View(endpoints.PK)
View(baseline.dat)
tbl.pk.co.model.b <-
PK.crossover.model.bviral %>%
tbl_regression(
exponentiate = F,
label = list(
period ~ "Period",
seq2 ~ "Sequence"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "$\\hat\\beta$")
)
tbl.pk.co.model.b %>%   as_kable(booktabs = T, caption = "Coefficent estimates of the carry-over effect model of blood viral loads.") %>%  kable_styling(latex_options = c("hold_position"), escape = F)
tbl.pk.co.model.b <-
PK.crossover.model.bviral %>%
tbl_regression(
exponentiate = F,
label = list(
period ~ "Period",
seq2 ~ "Sequence"
)
) %>%
modify_header(
update = list(p.value = "p-value", ci = "$95\\%$ CI", label = "Characteristics", estimate = "$\\hat\\beta$")
)
tbl.pk.co.model.b %>%   as_kable(booktabs = T, caption = "Coefficent estimates of the carry-over effect model of blood viral loads.", escape = F) %>%  kable_styling(latex_options = c("hold_position"))
