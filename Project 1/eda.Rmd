---
title: "eda"
author: "Fanyu, Ryan, Serena"
date: "2024-02-19"
output: pdf_document
---


```{r}
library(tidyverse)
library(lme4)
library(nlme)
library(lattice)
library(ggplot2)
```

```{r}
source(knitr::purl("P9185_project1.Rmd", quiet=TRUE))
```

```{r}
vload_df <- baseline.dat %>%
  pivot_longer(cols = contains("viral"), names_to = "type", values_to = "value") %>%
  mutate(obs_num = as.numeric(str_sub(type,-1,-1)),
         measure = str_sub(type,1,1),
         type = case_when(obs_num == 0 ~ "baseline",
                          obs_num %% 2 == 0 ~ "washout",
                          .default = "after"),
         period = case_when(
           obs_num <= 1 ~ 1,
           obs_num %in% c(2,3) ~ 2,
           obs_num %in% c(4,5,6) ~ 3,
           #washout in the end 
           .default = 4),
         sequence = paste0(
           str_sub(period1,-1,-1), 
           str_sub(period2,-1,-1),
           str_sub(period3,-1,-1))) %>%
  left_join(endpoints.AE %>%select(-week) %>% distinct(), by = c("ptid", "period", "sequence")) %>%
  mutate(measure = if_else(measure == "b", "blood", "skin")) %>%
  drop_na()
```

```{r}

vload_df$seq2 = factor(vload_df$seq2)
                       
                       
levels(vload_df$seq2) <- c("0" = 'rho[AB]', "1" = 'rho[AC]', "2" = 'rho[BC]')

# maybe not including washout 3
vload_df %>%
  ggplot(aes(x = obs_num, y = value, group = ptid)) +
  geom_line(alpha = 0.2, linewidth = 0.5)+
  facet_grid(seq2~measure,labeller = label_parsed)+
  theme_bw()+
  ylab("Viral Load")+
  xlab("")+
  scale_x_continuous(breaks=seq(0,6),
                     labels=c("0" = "Baseline", "1" = "Trt 1",
                              "2" = "Washout 1", "3" = "Trt 2",
                            "4" = "Washout 2", "5" = "Trt 3",
                            "6" = "Washout 3"))+
  theme(axis.text.x = element_text(angle = 30, vjust = 0.7))+
  ggtitle("Observed Viral Load & Remaining Effects")

```
