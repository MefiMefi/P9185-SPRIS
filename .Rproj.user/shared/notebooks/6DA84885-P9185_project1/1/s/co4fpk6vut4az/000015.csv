"0","endpoints.AE <-"
"0","  endpoints.dat %>% "
"0","  select(ptid,  AE_pillA_week1:AE_gelC_week4) %>% "
"0","  pivot_longer("
"0","    cols = starts_with(""AE_""),"
"0","    names_to = c(""drug"", ""week""),"
"0","    names_pattern = ""AE_(.*)_(week\\d+)"","
"0","    values_to = ""AE"""
"0","  ) %>%"
"0","  mutate(drug = case_when("
"0","    str_detect(drug, ""pillA"") ~ ""Pill A"","
"0","    str_detect(drug, ""gelB"") ~ ""Gel B"","
"0","    str_detect(drug, ""gelC"") ~ ""Gel C"""
"0","  ),"
"0","  week = parse_number(week))"
"0",""
"0","endpoints.Adhere <-"
"0","  endpoints.dat %>% "
"0","  select(ptid, Adhere_pillA_week1:Adhere_gelC_week4) %>% "
"0","  pivot_longer("
"0","    cols = starts_with(""Adhere_""),"
"0","    names_to = c(""drug"", ""week""),"
"0","    names_pattern = ""Adhere_(.*)_(week\\d+)"","
"0","    values_to = ""Adhere"""
"0","  ) %>%"
"0","  mutate(drug = case_when("
"0","    str_detect(drug, ""pillA"") ~ ""Pill A"","
"0","    str_detect(drug, ""gelB"") ~ ""Gel B"","
"0","    str_detect(drug, ""gelC"") ~ ""Gel C"""
"0","  ),"
"0","  week = parse_number(week)) %>% "
"0","  mutate(drug = factor(drug, levels = c(""Pill A"", ""Gel B"", ""Gel C"")))"
"0",""
"0","endpoints.period <- "
"0","  endpoints.dat %>% "
"0","  select(ptid, period1:period3) %>% "
"0","  mutate(sequence = case_when("
"0","    period1 == ""Pill A"" & period2 == ""Gel B"" & period3 == ""Gel C"" ~ ""ABC"","
"0","    period1 == ""Pill A"" & period2 == ""Gel C"" & period3 == ""Gel B"" ~ ""ACB"","
"0","    period1 == ""Gel B"" & period2 == ""Gel C"" & period3 == ""Pill A"" ~ ""BCA"","
"0","    period1 == ""Gel B"" & period2 == ""Pill A"" & period3 == ""Gel C"" ~ ""BAC"","
"0","    period1 == ""Gel C"" & period2 == ""Pill A"" & period3 == ""Gel B"" ~ ""CAB"","
"0","    period1 == ""Gel C"" & period2 == ""Gel B"" & period3 == ""Pill A"" ~ ""CBA"","
"0","    TRUE ~ ""Other"" # This is the default case"
"0","  )) %>% "
"0","  mutate("
"0","    seq1 = case_when("
"0","    sequence == ""ABC"" ~ 1,"
"0","    sequence == ""CAB"" ~ 2,"
"0","    sequence == ""BCA"" ~ 3,"
"0","    sequence == ""BAC"" ~ 4,"
"0","    sequence == ""ACB"" ~ 5,"
"0","    sequence == ""CBA"" ~ 6,"
"0","  ),"
"0","    seq2 = case_when("
"0","      sequence == ""ABC"" | sequence == ""BAC"" ~ 0,"
"0","      sequence == ""CAB"" | sequence == ""ACB"" ~ 1,"
"0","      sequence == ""BCA"" | sequence == ""CBA"" ~ 2"
"0","    )) %>% "
"0","  pivot_longer("
"0","    cols = starts_with(""period""),"
"0","    names_prefix = ""period"","
"0","    names_to = ""period"","
"0","    values_to = ""drug"""
"0","  ) %>% "
"0","  mutate(period = as.numeric(period)) %>% "
"0","  mutate(drug = factor(drug, levels = c(""Pill A"", ""Gel B"", ""Gel C"")))"
"0",""
"0","endpoints.lag <- "
"0","  endpoints.period %>% "
"0","  select(ptid, period, drug) %>% "
"0","  group_by(ptid) %>% "
"0","  mutate(drug_lag = lag(as.character(drug))) %>% "
"0","  ungroup() %>% "
"0","  replace_na(list(drug_lag = ""None"")) %>% "
"0","  mutate("
"0","    A_lag = ifelse(drug_lag == ""Pill A"", 1, 0),"
"0","    B_lag = ifelse(drug_lag == ""Gel B"", 1, 0),"
"0","    C_lag = ifelse(drug_lag == ""Gel C"", 1, 0)"
"0","  )%>% "
"0","  mutate(drug = factor(drug, levels = c(""Pill A"", ""Gel B"", ""Gel C"")))"
"0",""
"0","endpoints.period <- left_join(endpoints.period, endpoints.lag)"
"2","Joining with `by = join_by(ptid, period, drug)`"
"0","endpoints.AE <- left_join(endpoints.AE, endpoints.period)"
"2","Joining with `by = join_by(ptid, drug)`"
"0","endpoints.Adhere <- left_join(endpoints.Adhere, endpoints.period)"
"2","Joining with `by = join_by(ptid, drug)`"
